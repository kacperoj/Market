@model IEnumerable<Market.Web.ViewModels.MyAuctionViewModel>

@{
    ViewData["Title"] = "Moje Aukcje";
}

<link rel="stylesheet" href="~/css/auction-index.css" asp-append-version="true" />

<div class="container mt-4 mb-5">
    
    <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
        <div>
            <h1 class="fw-bold mb-0">Moje Oferty</h1>
            <p class="text-muted mb-0">Zarządzaj statusem i widocznością swoich przedmiotów</p>
        </div>
        <a asp-action="Create" class="btn btn-success fw-bold px-4 shadow-sm">Start</a>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5 bg-light rounded-3 shadow-sm opacity-75">
            <h4 class="fw-bold">Brak aukcji</h4>
            <a asp-action="Create" class="btn btn-primary mt-2">Wystaw przedmiot</a>
        </div>
    }
    else
    {
        <div class="d-flex flex-column gap-3">
            @foreach (var item in Model)
            {
                <div class="card auction-row-card rounded-3 overflow-hidden position-relative shadow-sm border-0">
                    <div class="row g-0 h-100">

                        <div class="col-md-4 col-xl-3">
                            <div class="auction-img-container h-100 position-relative">
                                <img src="@item.ImageUrl" class="w-100 h-100 object-fit-cover" alt="@item.Title" />
                                
                                <span class="badge @item.StatusBadgeClass position-absolute top-0 start-0 m-2 shadow-sm">
                                    @item.StatusLabel
                                </span>
                                <span class="badge bg-black bg-opacity-75 position-absolute bottom-0 start-0 m-2 border border-secondary">
                                    @item.Category
                                </span>
                            </div>
                        </div>

                        <div class="col-md-8 col-xl-9">
                            <div class="card-body h-100 d-flex flex-column flex-md-row">
                                <div class="flex-grow-1 pe-md-4">
                                    <h4 class="card-title fw-bold mb-2">
                                        <a asp-action="Details" asp-route-id="@item.Id" class="text-reset text-decoration-none stretched-link">
                                            @item.Title
                                        </a>
                                    </h4>

                                    <div class="mb-3 text-secondary small d-flex flex-wrap gap-3">
                                        @if (!item.IsSoldOut)
                                        {
                                            <span><i class="bi bi-box-seam me-1"></i> Dostępne: @item.Quantity szt.</span>
                                        }
                                        else
                                        {
                                            <span class="text-danger fw-bold">Sprzedane</span>
                                        }
                                        
                                        <span class="@(item.IsExpired ? "text-danger fw-bold" : "")">
                                            Koniec: @item.EndDateFormatted
                                        </span>

                                        @if(item.IsCompanySale)
                                        {
                                            <span class="text-primary fw-bold"><i class="bi bi-receipt me-1"></i>Faktura VAT</span>
                                        }
                                    </div>

                                    <p class="card-text text-secondary text-truncate-3 mb-0">
                                        @item.Description
                                    </p>

                                    @if(item.IsBannedOrSuspended && !string.IsNullOrEmpty(item.BannedNote))
                                    {
                                        <div class="alert alert-danger py-2 px-3 small shadow-sm border-0 bg-danger bg-opacity-10 text-danger mb-2 mt-3 position-relative" style="z-index: 2;">
                                            <strong>ZABLOKOWANA:</strong> @item.BannedNote
                                        </div>
                                    }
                                </div>

                                <div class="price-section ps-md-3 border-start-md d-flex flex-column justify-content-between" style="min-width: 200px;">
                                    <div class="text-md-end mb-3">
                                        <h3 class="text-warning fw-bolder mb-0">@item.Price.ToString("N2") <small class="fs-6 text-muted">PLN</small></h3>
                                        @if(item.GeneratedByAi)
                                        {
                                            <small class="badge bg-info bg-opacity-10 text-info border border-info mt-1">Opis AI</small>
                                        }
                                    </div>

                                    <div class="d-grid gap-2 mt-auto text-end">
                                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-primary btn-sm fw-bold position-relative" style="z-index: 2;">
                                            <i class="bi bi-pencil-square me-1"></i> Edytuj
                                        </a>
                                        <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-secondary btn-sm position-relative" style="z-index: 2;">
                                            Podgląd
                                        </a>
                                        <span class="text-muted x-small mt-2">Utworzono: @item.CreatedAtFormatted</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>